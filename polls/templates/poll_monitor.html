{% extends "base.html" %} {% block content %}
<div class="card">
  <div
    style="
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 1px solid #e3e3e3;
      padding-bottom: 20px;
    "
  >
    <h2 style="margin: 0">Analytics: {{ poll.question }}</h2>
    <span style="font-weight: 700; color: #1a73e8; font-size: 1.2rem"
      >{{ poll.total_votes }} Votes</span
    >
  </div>

  <div
    style="
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 20px;
      margin: 32px 0;
    "
  >
    <div style="height: 250px"><canvas id="bar"></canvas></div>
    <div style="height: 250px"><canvas id="pie"></canvas></div>
    <div style="height: 250px"><canvas id="plot"></canvas></div>
  </div>

  <div
    style="border-top: 1px solid #e3e3e3; padding-top: 24px; text-align: center"
  >
    <p style="font-weight: 700; color: #5f6368; margin-bottom: 12px">
      OFFICIAL SHARE LINK
    </p>
    <code
      id="share-link"
      style="
        background: #f1f3f4;
        padding: 12px;
        border-radius: 8px;
        display: inline-block;
      "
      >{{ request.scheme }}://{{ request.get_host }}/poll/{{ poll.slug }}/</code
    >
    <br /><br />
    <button
      class="btn"
      onclick="
        navigator.clipboard.writeText(
          document.getElementById('share-link').innerText,
        );
        alert('Link Copied!');
      "
    >
      Copy Link
    </button>
  </div>
</div>

<script>
  const labels = [{% for o in poll.options.all %}"{{ o.text }}",{% endfor %}];
  const votes = [{% for o in poll.options.all %}{{ o.vote_count }},{% endfor %}];
  const colors = ['#1a73e8', '#34a853', '#fbbc04', '#ea4335'];

  new Chart(document.getElementById('bar'), { type: 'bar', data: { labels, datasets: [{ data: votes, backgroundColor: '#1a73e8' }] }, options: { maintainAspectRatio: false, plugins: { legend: { display: false } } } });
  new Chart(document.getElementById('pie'), { type: 'pie', data: { labels, datasets: [{ data: votes, backgroundColor: colors }] }, options: { maintainAspectRatio: false } });
  new Chart(document.getElementById('plot'), { type: 'line', data: { labels, datasets: [{ data: votes, borderColor: '#1a73e8', fill: false, tension: 0.4 }] }, options: { maintainAspectRatio: false, plugins: { legend: { display: false } } } });
</script>
{% endblock %}
